<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カメラレジ - カート機能付</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #f4f4f4; padding: 20px; }
        #reader { width: 100%; max-width: 400px; margin: 0 auto; background: white; border-radius: 10px; overflow: hidden; }
        #result-container { display: none; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin: 20px auto; max-width: 400px; }
        .price { font-size: 2.5em; color: #e74c3c; font-weight: bold; margin: 10px 0; }
        #cart { margin-top: 30px; text-align: left; max-width: 400px; margin-left: auto; margin-right: auto; background: #fff; padding: 15px; border-radius: 8px; }
        .cart-item { display: flex; justify-content: space-between; border-bottom: 1px solid #ddd; padding: 5px 0; }
        .total { font-size: 1.5em; font-weight: bold; text-align: right; margin-top: 15px; border-top: 2px solid #333; }
        button { background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 5px; font-size: 1em; cursor: pointer; margin-top: 10px; }
        button:active { background: #2980b9; }
        #start-btn { font-size: 1.2em; padding: 20px 40px; background: #2ecc71; }
    </style>
</head>
<body>

    <h1>カメラレジシステム</h1>

    <div id="setup">
        <button id="start-btn" onclick="initSystem()">はじまる</button>
        <p>※クリックするとカメラと音が有効になります</p>
    </div>

    <div id="reader-wrapper" style="display:none;">
        <div id="reader"></div>
        <p>QRコードを枠に合わせてください</p>
    </div>

    <div id="result-container">
        <h2 id="item-name">商品名</h2>
        <p class="price"><span id="item-price">0</span>えん</p>
        <button onclick="resumeScanning()">つぎのちゅうもん</button>
    </div>

    <div id="cart">
        <h3>かったもの</h3>
        <div id="cart-items"></div>
        <div class="total">ごうけい: <span id="total-price">0</span>えん</div>
        <button style="width:100%; background:#95a5a6;" onclick="clearCart()">もういちどはじめる</button>
    </div>

    <script>
        const itemMaster = {
            "ピザトースト": { name: "ぴざとーすと", price: 100 },
            "ピザドッグ": { name: "ぴざどっぐ", price: 100 },
            "A003": { name: "コーヒー", price: 120 }
        };

        let cart = [];
        let html5QrCode;
        
        // 読み込み音（電子音を生成）
        const beep = () => {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            osc.type = "sine";
            osc.frequency.setValueAtTime(1000, ctx.currentTime);
            osc.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + 0.1);
        };

        function initSystem() {
            document.getElementById("setup").style.display = "none";
            document.getElementById("reader-wrapper").style.display = "block";
            
            html5QrCode = new Html5Qrcode("reader");
            startCamera();
        }

        function startCamera() {
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            html5QrCode.start({ facingMode: "environment" }, config, onScanSuccess);
        }

        function onScanSuccess(decodedText) {
            const item = itemMaster[decodedText];
            if (item) {
                beep(); // 音を鳴らす
                addToCart(item);
                showResult(item);
            }
        }

        function showResult(item) {
            // カメラを止めて隠す
            html5QrCode.stop().then(() => {
                document.getElementById("reader-wrapper").style.display = "none";
                // 結果を表示
                document.getElementById("item-name").innerText = item.name;
                document.getElementById("item-price").innerText = item.price;
                document.getElementById("result-container").style.display = "block";
            });
        }

        function resumeScanning() {
            document.getElementById("result-container").style.display = "none";
            document.getElementById("reader-wrapper").style.display = "block";
            startCamera();
        }

        function addToCart(item) {
            cart.push(item);
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const container = document.getElementById("cart-items");
            container.innerHTML = "";
            let total = 0;
            cart.forEach(item => {
                const div = document.createElement("div");
                div.className = "cart-item";
                div.innerHTML = `<span>${item.name}</span><span>${item.price}えん</span>`;
                container.appendChild(div);
                total += item.price;
            });
            document.getElementById("total-price").innerText = total;
        }

        function clearCart() {
            cart = [];
            updateCartDisplay();
            resumeScanning();
        }
    </script>
</body>
</html>
